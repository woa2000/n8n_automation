{"createdAt":"2025-07-08T17:08:06.072Z","updatedAt":"2025-07-23T14:03:20.000Z","id":"EmtFdDs6oSypCHIs","name":"Mobilevet Principal","active":true,"nodes":[{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Erro ao confirmar agendamento! Favor entre em contato com o atendimento.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[220,-100],"id":"db5d75f7-83f7-465f-9768-9184977d1049","name":"MSG Confirmação Erro","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"method":"POST","url":"https://mobilevet-homolog.azurewebsites.net/api/chatwoot/ConfirmarExame","sendBody":true,"bodyParameters":{"parameters":[{"name":"AtendimentoId","value":"={{ $json.respostaLista }}"},{"name":"Resposta","value":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-220,40],"id":"6bfb88f3-e75d-4234-a90f-fced24bfab44","name":"Confirma Agendamento","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3092970b-081f-43f5-b726-4548ae0570a9","leftValue":"={{ $json.StatusConfirmacao }}","rightValue":"Confirmação tratada com sucesso!","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-260,-220],"id":"b0d37c5a-76eb-457f-89dd-3e46c26cbaaa","name":"Confirmado com Sucesso?","executeOnce":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3092970b-081f-43f5-b726-4548ae0570a9","leftValue":"={{ $json.StatusConfirmacao }}","rightValue":"Confirmação tratada com sucesso!","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-80,420],"id":"40c3dba2-ba7d-4816-a931-37b62d14149e","name":"Cancelado com sucesso?"},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Agendamento confirmado com sucesso! ","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[220,-240],"id":"c506a317-ee13-413e-8807-c64aba19f7a7","name":"MSG Confimação Sucesso","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","operation":"send-list","options_message":{},"instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","title":"Agendamento cancelado com sucesso!","description":"Deseja Reagendar o exame","footerText":" ","sections":{"sectionValues":[{"title":" ","rows":{"rowValues":[{"title":"Reagendar","rowId":"OP7_Reagendar"},{"title":"Cancelar","rowId":"OP8_Cancelar"}]}}]}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[260,380],"id":"cdc47100-d802-489b-aa77-bdbdc9a01b20","name":"MSG Cancelamento sucesso","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Tranferindo para Agendar Exame","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-660,980],"id":"a4d276d4-880d-4798-9698-04fb99c35678","name":"MSG Reagendamento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Agendamento cancelado. Atendimento encerrado","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[280,740],"id":"21526dc0-638b-45d6-8f52-c274abf1017e","name":"MSG Cancelamento Definitivo","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"operation":"set","key":"={{ $json.remoteJid }}_block","value":"true","keyType":"string","expire":true,"ttl":180},"id":"37759797-4d61-4759-bcdd-6d17b32f9052","name":"Block IA1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-3220,940],"credentials":{"redis":{"id":"gG8VhT5nokZGqEH8","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"9fd12788-3c02-4a42-8f3a-e0f34b40b76a","leftValue":"={{ $item(\"0\").$node[\"Webhook1\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}","rightValue":"@s.whatsapp.net","operator":{"type":"string","operation":"endsWith"}}],"combinator":"and"},"options":{}},"id":"15bd02ed-5497-4ada-bc3b-84a22d996907","name":"bloqueia_grupo1","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3900,1140]},{"parameters":{"httpMethod":"POST","path":"mobilevet-integracao-atendimento","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-4160,1140],"id":"c5f273da-5a4b-4d86-a18c-c85528c7ed97","name":"Webhook1","webhookId":"856faf61-b63e-4acb-a537-fdb3fc0e20c2"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $item(\"0\").$node[\"DadosWhastApp\"].json[\"fromMe\"] }}","rightValue":"true","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"MinhaMensagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"47adcb9e-74a9-487c-9aa5-ef65dec84847","leftValue":"={{ $item(\"0\").$node[\"DadosWhastApp\"].json[\"fromMe\"] }}","rightValue":"=false","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"MensagemCliente"}]},"options":{}},"id":"503897f0-83d5-4638-bbb1-75f0ca859708","name":"Tipo Mensagem1","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-3400,1120]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP5","operator":{"type":"string","operation":"equals"},"id":"5dc4e63e-1c9d-452d-b341-1cb8b93feccf"}],"combinator":"and"},"renameOutput":true,"outputKey":"Confirmacao SIM"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7622d2e8-85e3-49ad-a83c-2119b073f26f","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP6","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Confirmacao NAO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"de4ae42b-73ac-4af7-9868-15775e525dee","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP7","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Reagendamento"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"eae8bdee-3158-43c4-81f6-2f00c61791ce","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP8","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cancelamento"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1bba60af-831b-4038-9dcb-ac22611ec296","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP1","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Solicitar Laudo"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3723dd6f-fb15-45d6-96fa-79820025d2e2","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP2","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Agendamento"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e1b48e5f-2a04-4e3d-8cdd-70c681edb257","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP3","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Atendimento"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4098ac84-3c41-4869-b070-b8226b9fab53","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP0","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Financeiro"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"eb6a317f-9aea-4ab5-9896-22c7529f5f78","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"LaudoId","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Laudo ID"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2680,980],"id":"db457b1a-5598-431e-a511-135301bbd648","name":"Confirmação Exame1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1cb964df-d722-46e3-8cfd-3aae1e64ea41","leftValue":"={{ $json.dataMaisDeDezMinutos }}","rightValue":"=","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-800,2660],"id":"b325e28a-d175-45bb-8eae-caded4c8a06a","name":"If Nova Mensagem1"},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=😃 Olá! Que bom ter você aqui na Mobilevet. Eu sou o seu assistente virtual e estou disponível para te ajudar a qualquer momento! Se preferir cancelar, digite: CANCELAR.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-260,2440],"id":"d5d2478c-3114-4069-819a-d3cd823bb564","name":"MSG Saudacao1","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","operation":"send-list","options_message":{},"instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","title":" ","description":"=Olá! Para continuarmos, selecione uma das opções abaixo 👇. Pode ficar tranquilo(a): além do suporte virtual, há sempre uma pessoa da equipe Mobilevet pronta para te atender se precisar.","footerText":" ","sections":{"sectionValues":[{"title":"Opções de atendimento","rows":{"rowValues":[{"title":"✉️ Solicitação de Laudo","description":" ","rowId":"OP1_SolicitarLaudo"},{"title":"👨‍⚕️🩺 Agendar Exame","description":" ","rowId":"OP2_AgendarExame"},{"title":"👩‍💻 Falar com Atendente","description":" ","rowId":"OP3_Atendente"},{"title":"💵 Falar com Financeiro","description":" ","rowId":"OP0_Financeiro"}]}}]}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-40,2440],"id":"fc178300-3787-439b-8ea4-93c9197ff7f7","name":"MSG Lista Inicial1","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"jsCode":"if ($json.dataMsg == null) {\n  return [\n    {\n      json: {\n        dataMaisDeDezMinutos: true,\n        diferencaMinutos: 0,\n      },\n    },\n  ];\n}\n\nconst dataRedisString = $json.dataMsg[0];\n\nif (!dataRedisString) {\n  console.error(\"Não foi possível encontrar uma data válida em $json.dataMsg.\");\n  return [\n    {\n      json: {\n        dataMaisDeDezMinutos: false,\n        erro: \"Data Redis não encontrada ou inválida.\",\n      },\n    },\n  ];\n}\n\nconst dataRedis = new Date(dataRedisString);\n\n// Obtem data atual no fuso horário de São Paulo\nconst dataSP = new Date().toLocaleString('pt-BR', {\n  timeZone: 'America/Sao_Paulo',\n  year: 'numeric',\n  month: '2-digit',\n  day: '2-digit',\n  hour: '2-digit',\n  minute: '2-digit',\n  second: '2-digit',\n  hour12: false,\n}).replace(',', '');\nconst dataAtual = new Date(dataSP);\n\n// Verifica se é do mesmo dia\nconst mesmoDia = (\n  dataRedis.getFullYear() === dataAtual.getFullYear() &&\n  dataRedis.getMonth() === dataAtual.getMonth() &&\n  dataRedis.getDate() === dataAtual.getDate()\n);\n\n// Se for de dia diferente, já considera como > 10 minutos\nif (!mesmoDia) {\n  return [\n    {\n      json: {\n        dataMaisDeDezMinutos: true,\n        diferencaMinutos: null,\n        motivo: \"Data de dias diferentes\",\n      },\n    },\n  ];\n}\n\n// Caso seja do mesmo dia, calcula a diferença\nconst diferencaMs = dataAtual.getTime() - dataRedis.getTime();\nconst diferencaMinutos = diferencaMs / (1000 * 60);\nconst limiteMinutos = 10;\n\nreturn [\n  {\n    json: {\n      dataMaisDeDezMinutos: diferencaMinutos > limiteMinutos,\n      diferencaMinutos,\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1040,2660],"id":"a3bedafa-1f94-4615-b7cc-435c34612de3","name":"Teste 10 min.1"},{"parameters":{"operation":"push","list":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageData":"={{ new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).replace(',', '') }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[200,2440],"id":"0619ffd8-5303-4274-9fa9-8c0e058e94d7","name":"Redis4","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"operation":"get","propertyName":"dataMsg","key":"={{ $('DadosWhastApp').item.json.remoteJid }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-1280,2660],"id":"bc2277ba-f2f1-4d27-90e6-68d20200e3fe","name":"Redis5","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"operation":"delete","key":"={{ $('DadosWhastApp').item.json.remoteJid }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1840,900],"id":"96788ed9-a937-41de-a91d-4faaa3e846e5","name":"Redis","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Erro ao cancelar agendamento! Favor entre em contato com o atendimento.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[280,600],"id":"4f6f1c54-bba6-4b77-86a5-8bbaa77a632c","name":"MSG Erro Cancelamento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Vamos começar seu agendamento? Para facilitar, basta nos informar:\n\n1º Quais exames deseja agendar\n2º A data que prefere para o atendimento\n3º Se prefere o período da manhã ou da tarde\n\nDessa forma, conseguimos agilizar seu atendimento e cuidar do seu pet com todo carinho! 💚\n\nAssim que recebermos sua resposta, um atendente seguirá com o agendamento. Obrigado por confiar na Mobilevet! 🐾\n\nSe preferir podemos continuar por uma ligação telefônica ☎, basta nos ligar:(11) 4235-5533","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-660,1120],"id":"bdf17a99-5f7c-43e7-96d9-091f159d9151","name":"MSG Agendamento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Transferindo para Agendar Exame","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-360,1120],"id":"f066a9bd-f3d2-478a-8e99-6516b73430fd","name":"MSG Tranf Agendamento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Aguarde só um pouquinho... Um atendente da Mobilevet já vai falar com você! 👩‍💻","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-720,1480],"id":"258ab2b7-6f5c-4f93-8e0c-e6bbf8d96276","name":"MSG Atendimento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Transferindo para Falar com Atendente","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-420,1480],"id":"ce62d34b-2ab3-4087-ba5f-aafa37cbc8b9","name":"MSG Tranf Atendimento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Aguarde só um pouquinho... Um atendente da Mobilevet já vai falar com você! 👩‍💻","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-720,1640],"id":"436582c4-1caf-4ded-83a0-a202476d6076","name":"MSG Financeiro","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Transferindo para Falar com Financeiro","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-420,1640],"id":"9c57ea2a-02bf-45b1-a43b-c5457be79bb0","name":"MSG Tranf Financeiro","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"url":"https://mobilevet-homolog.azurewebsites.net/api/chatwoot/ConsultarClienteCelular","sendQuery":true,"queryParameters":{"parameters":[{"name":"celular","value":"={{ $('DadosWhastApp').item.json.remoteJid }}"}]},"options":{"redirect":{"redirect":{"followRedirects":false}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[340,2700],"id":"03d29d94-9a46-4e3c-ab6a-1b8f0dccb026","name":"Consulta Cliente"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"79ed0aac-0dce-4d96-bfb0-73b250d71fd8","leftValue":"={{ $json.data }}","rightValue":"Cliente não encontrado.","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[600,2700],"id":"f1918737-6cf0-47e8-a0b5-df8e7284adfe","name":"If1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP1","operator":{"type":"string","operation":"equals"},"id":"76c51969-6159-4c1b-8bdf-5218667791ff"}],"combinator":"and"},"renameOutput":true,"outputKey":"Solicitar Laudo"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8917477f-3efa-46f0-afb8-f2eb42264b63","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP9","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cliente Reconhecido"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c0e0fa43-4ddc-4acd-951a-4e5715b3ce52","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"OP10","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Buscar Cliente"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f07b64fb-1b0e-4864-8be5-d896f097be64","leftValue":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}","rightValue":"ForaDaLista","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Laudo Fora Lista"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-220,2800],"id":"d44415f7-35e3-4740-bdb6-26f486d52174","name":"Switch"},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Certo. Por favor, informe o CNPJ ou CPF","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[640,3220],"id":"3b941493-1056-4422-9aa9-34f1ee3490d0","name":"Solicitar Documento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"jsCode":"const input = $('DadosWhastApp').first().json.conversation?.trim();\n\nfunction isCPF(value) {\n  return /^\\d{3}\\.?\\d{3}\\.?\\d{3}-?\\d{2}$/.test(value);\n}\n\nfunction isCNPJ(value) {\n  return /^\\d{2}\\.?\\d{3}\\.?\\d{3}\\/?\\d{4}-?\\d{2}$/.test(value);\n}\n\nfunction isDate(value) {\n  return /^\\d{2}\\/\\d{2}\\/\\d{4}$/.test(value) || /^\\d{4}-\\d{2}-\\d{2}$/.test(value);\n}\n\nfunction formatDate(value) {\n  // Se for dd/MM/yyyy, converte para yyyy-MM-dd\n  if (/^\\d{2}\\/\\d{2}\\/\\d{4}$/.test(value)) {\n    const [day, month, year] = value.split('/');\n    return `${year}-${month}-${day}`;\n  }\n  // Se já estiver no formato yyyy-MM-dd, retorna como está\n  return value;\n}\n\nlet tipo = \"Desconhecido\";\nlet valorTratado = input;\n\nif (isCPF(input)) {\n  tipo = \"CPF\";\n} else if (isCNPJ(input)) {\n  tipo = \"CNPJ\";\n} else if (isDate(input)) {\n  tipo = \"Data\";\n  valorTratado = formatDate(input);\n}\n\nreturn [\n  {\n    json: {\n      tipoCampo: tipo,\n      valor: valorTratado,\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[480,3560],"id":"f8e39f32-99be-4f3f-a162-1b6f85914e25","name":"Valida Texto Livre"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.tipoCampo }}","rightValue":"CNPJ","operator":{"type":"string","operation":"equals"},"id":"055f5766-9627-48b7-a140-81e2a29be4ba"}],"combinator":"and"},"renameOutput":true,"outputKey":"CNPJ"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98e79726-f5c7-452b-9b86-961dc2bdca63","leftValue":"={{ $json.tipoCampo }}","rightValue":"CPF","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"CPF"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6337ddb0-70f0-4354-adb6-ff415fc7da2d","leftValue":"={{ $json.tipoCampo }}","rightValue":"Data","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"DataLaudo"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[700,3540],"id":"50662fdc-6d5e-491e-a7f1-41204c2307e9","name":"Switch1"},{"parameters":{"url":"https://mobilevet-homolog.azurewebsites.net/api/chatwoot/ConsultarClienteCPFCNPJ","sendQuery":true,"queryParameters":{"parameters":[{"name":"documento","value":"={{ $json.valor }}"}]},"options":{"redirect":{"redirect":{"followRedirects":false}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1060,3260],"id":"473d30af-bd04-499f-a08c-660d5965122d","name":"Consulta Cliente1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"79ed0aac-0dce-4d96-bfb0-73b250d71fd8","leftValue":"={{ $json.data }}","rightValue":"Cliente não encontrado.","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1400,3260],"id":"011ee245-436c-4d5c-89ed-48b6e6308729","name":"If"},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Cliente não encontrado. Por favor, informe o CNPJ ou CPF","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1740,3240],"id":"97286a01-c7b4-42c0-a95b-0e3b37e53236","name":"Solicitar Documento1","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"url":"https://mobilevet-homolog.azurewebsites.net/api/ChatWoot/ConsultarLaudosCliente","sendQuery":true,"queryParameters":{"parameters":[{"name":"clienteId","value":"={{ $('Consulta Cliente1').item.json.id }}"},{"name":"celular","value":"={{ $('DadosWhastApp').item.json.remoteJid }}"}]},"options":{"redirect":{"redirect":{"followRedirects":false}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1740,3400],"id":"65e8e2ae-1722-424e-8273-58bdc1390afe","name":"HTTP Consulta Laudos"},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Obrigado por aguardar. Segue link do laudo.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-860,1920],"id":"11af3c9a-04e0-4a8b-a420-a5e98ca5c072","name":"MSG Linklaudo","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=https://mobilevet-homolog.azurewebsites.net/Laudos/LaudosWeb?Id={{ $('Confirmação Exame1').item.json.respostaLista[1] }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-540,1920],"id":"ee695a17-39a6-443d-a6d3-a47f57ff310e","name":"Enviar Link","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Atendimento Encerrado.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-280,1920],"id":"2cbf8641-dccd-44aa-8e03-0b8c146bf38f","name":"Encerrando Atendimento","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"url":"https://mobilevet-homolog.azurewebsites.net/api/ChatWoot/ConsultarLaudosCliente","sendQuery":true,"queryParameters":{"parameters":[{"name":"clienteId","value":"={{ $('DadosWhastApp').item.json.respostaLista[1] }}"},{"name":"celular","value":"={{ $('DadosWhastApp').item.json.remoteJid }}"}]},"options":{"redirect":{"redirect":{"followRedirects":false}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[620,3020],"id":"e2fb7d89-9bc8-4258-bdfe-82d224f13bb5","name":"HTTP Consulta Laudos1"},{"parameters":{"resource":"messages-api","operation":"send-list","options_message":{},"instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","title":" ","description":"=O Laudo que você deseja é da clínica: {{ $('Consulta Cliente').item.json.nomeFantasia }}?\nPor favor, selecione uma das opções abaixo 👇","footerText":" ","sections":{"sectionValues":[{"title":"Opções de atendimento","rows":{"rowValues":[{"title":"Sim","description":" ","rowId":"=OP9_{{ $('Consulta Cliente').item.json.id }}"},{"title":"Não","description":" ","rowId":"OP10_ConsultaCliente"}]}}]}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[820,2800],"id":"13d4bdf9-8755-411f-85b5-0f37f174666c","name":"MSG Confirgma Cliente","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"content":"## Confirma Agendamento","height":620,"width":1660,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-1200,-280],"typeVersion":1,"id":"97f4da99-ba0b-4470-8c7e-a72d7801c1bf","name":"Sticky Note"},{"parameters":{"content":"## Cancela Agendamento","height":520,"width":1680,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-1200,360],"typeVersion":1,"id":"d55138df-68ae-43e0-a3f3-99ccd1b0c884","name":"Sticky Note1"},{"parameters":{"content":"## Agendamento - Transferência","height":480,"width":880},"type":"n8n-nodes-base.stickyNote","position":[-1200,900],"typeVersion":1,"id":"feac1539-9e1d-4eaf-8309-24f6fc083eeb","name":"Sticky Note2"},{"parameters":{"content":"## Falar com Atendimento/Financeiro","height":380,"width":900},"type":"n8n-nodes-base.stickyNote","position":[-1200,1420],"typeVersion":1,"id":"e3a36ea7-ab4d-4f88-81dc-ab7fde9c6655","name":"Sticky Note3"},{"parameters":{"content":"## Link Laudo","height":240,"width":920,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1200,1840],"typeVersion":1,"id":"e8fbdc22-3f0a-4fd3-8fc4-66f2f5bcdc58","name":"Sticky Note4"},{"parameters":{"content":"## Solicitar Laudo","height":1780,"width":3980,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-1820,2340],"typeVersion":1,"id":"e39d86b2-74df-4fe7-8669-f44a10ca2d7e","name":"Sticky Note5"},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"Favor informar a data do exame desejado","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[640,3380],"id":"53e122fd-04e4-4243-8b08-96a43d7e4bab","name":"Solicitar Data Laudo","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"url":"https://mobilevet-homolog.azurewebsites.net/api/ChatWoot/ConsultarLaudosClienteData","sendQuery":true,"queryParameters":{"parameters":[{"name":"clienteId","value":"={{ $json.ClienteId }}"},{"name":"data","value":"={{ $('Switch1').item.json.valor }}"},{"name":"Celular","value":"={{ $('DadosWhastApp').item.json.remoteJid }}"}]},"options":{"redirect":{"redirect":{"followRedirects":false}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1320,3580],"id":"18b34d38-0976-44a8-b0d4-d8dd4b0164da","name":"Consulta Laudo Data"},{"parameters":{"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-580,2760],"id":"636ee07a-b66c-43fd-8fe1-9f28fc09caa1","name":"Edit Fields3"},{"parameters":{"operation":"set","key":"={{ $('DadosWhastApp').item.json.remoteJid }}_Id","value":"={{ $('DadosWhastApp').item.json.respostaLista[1] }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[260,2900],"id":"0fb85cb8-1f24-4846-874b-2e5ca4f1569f","name":"Salva IdCliente","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"operation":"set","key":"={{ $('DadosWhastApp').item.json.remoteJid }}_Id","value":"={{ $('Consulta Cliente1').item.json.id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1560,3400],"id":"7eae315c-c622-4d12-9493-2ec5923c03bc","name":"Salva IdCliente1","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"operation":"get","propertyName":"ClienteId","key":"={{ $('DadosWhastApp').item.json.remoteJid }}_Id","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1060,3580],"id":"b52b54c0-506a-4953-995e-18e6ecd4645c","name":"Salva IdCliente2","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-480,20],"id":"b2a71c64-ab05-4c58-9328-e1934d075c61","name":"Loop Over Items2","executeOnce":false,"alwaysOutputData":false},{"parameters":{"fieldToSplitOut":"Ids","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-680,20],"id":"59944391-7c61-4efa-93c1-aa6d38b66096","name":"Split Out"},{"parameters":{"assignments":{"assignments":[{"id":"8a9e3cf8-ed81-432f-97ed-3e313dda6117","name":"remoteJid","value":"={{ $('Webhook1').item.json.body.data.key.remoteJid.toString().replace(/@s\\.whatsapp\\.net$/, '') }}","type":"string"},{"id":"c462d894-872e-4dfa-93f8-f5473ba0a874","name":"pushName","value":"={{ $item(\"0\").$node[\"Webhook1\"].json[\"body\"][\"data\"][\"pushName\"] }}","type":"string"},{"id":"8f1dd78d-2cdf-4ccd-93de-f1f9fcf05242","name":"conversation","value":"={{ $item(\"0\").$node[\"Webhook1\"].json[\"body\"][\"data\"][\"message\"][\"conversation\"] }}","type":"string"},{"id":"52a755db-c4a7-40ed-adb8-db8783fac6ca","name":"messageType","value":"={{ $item(\"0\").$node[\"Webhook1\"].json[\"body\"][\"data\"][\"messageType\"] }}","type":"string"},{"id":"2bc74008-8683-46cc-af56-74f3f17a8109","name":"fromMe","value":"={{ $item(\"0\").$node[\"Webhook1\"].json[\"body\"][\"data\"][\"key\"][\"fromMe\"] }}","type":"string"},{"id":"b45af9ee-b316-4a90-ac1c-2eb9c1c23e1f","name":"base64","value":"={{ $item(\"0\").$node[\"Webhook1\"].json[\"body\"][\"data\"][\"message\"][\"base64\"] }}","type":"string"},{"id":"093bad27-8059-4ead-b7b8-5d8e2aee5c45","name":"respostaLista","value":"={{ $('Webhook1').item.json.body.data.message.listResponseMessage.singleSelectReply.selectedRowId.split(\"_\") }}","type":"array"},{"id":"8045432d-507c-4717-9e17-8bc3bacaab99","name":"dataMsg","value":"={{ $('Webhook1').item.json.body.date_time }}","type":"string"},{"id":"2a506c76-9e11-413b-8f2d-dd4ac5f25b1c","name":"Message","value":"={{ $('Webhook1').item.json.body.data.message }}","type":"object"}]},"options":{}},"id":"34a60761-03c1-4713-9961-a97f84acf394","name":"DadosWhastApp","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3620,1120]},{"parameters":{"assignments":{"assignments":[{"id":"91f68ef0-10fa-4c29-8e90-c7c60a55dd88","name":"StatusConfirmacao","value":"={{ $json.data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[20,100],"id":"8463af96-9c93-4288-addf-071aa4522254","name":"ResultadoConfirmacao"},{"parameters":{"assignments":{"assignments":[{"id":"b4e784cd-57ed-4e64-927b-0f3a08bb6616","name":"Ids","value":"={{ $json.respostaLista.filter(x => !x.includes('OP')) }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-880,20],"id":"68cc3859-86c9-4bd9-83e9-897a3525ec46","name":"ListaIds"},{"parameters":{"method":"POST","url":"https://mobilevet-homolog.azurewebsites.net/api/chatwoot/ConfirmarExame","sendBody":true,"bodyParameters":{"parameters":[{"name":"AtendimentoId","value":"={{ $json.respostaLista }}"},{"name":"Resposta","value":"={{ $('DadosWhastApp').item.json.respostaLista[0] }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-260,560],"id":"4d44385c-a64b-465d-9e01-108cc8bb7cc8","name":"Confirma Agendamento1","onError":"continueRegularOutput"},{"parameters":{"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-520,540],"id":"dcfef5f0-e438-4d0e-a024-c9e302838bd7","name":"Loop Over Items","executeOnce":false,"alwaysOutputData":false},{"parameters":{"fieldToSplitOut":"Ids","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-720,540],"id":"3210ec58-d005-43a6-9d6c-22fd89cb4d48","name":"Split Out1"},{"parameters":{"assignments":{"assignments":[{"id":"91f68ef0-10fa-4c29-8e90-c7c60a55dd88","name":"StatusConfirmacao","value":"={{ $json.data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-20,620],"id":"c7ab732b-d6c0-4153-8342-00a17c9fa827","name":"ResultadoConfirmacao1"},{"parameters":{"assignments":{"assignments":[{"id":"b4e784cd-57ed-4e64-927b-0f3a08bb6616","name":"Ids","value":"={{ $json.respostaLista.filter(x => !x.includes('OP')) }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-920,540],"id":"a639d624-103d-4f7b-b630-9fc7d1b3099c","name":"ListaIds1"},{"parameters":{"operation":"push","list":"={{ $json.tipoCampo }}","messageData":"={{ $('DadosWhastApp').item.json.Message.conversation }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1060,3820],"id":"c8029874-f049-4cb7-8609-947a7c7ac02d","name":"Redis1","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"operation":"get","propertyName":"Erros","key":"={{ $json.tipoCampo }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1340,3820],"id":"e3731e50-b4e8-4124-b543-3cb7fe574355","name":"Redis2","credentials":{"redis":{"id":"QGqIVKbiyQHm3x0E","name":"Redis account 2"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"97fe3e1c-b748-46c8-8b9c-de042e2742b9","leftValue":"={{ $json.Erros }}","rightValue":2,"operator":{"type":"array","operation":"lengthGte","rightType":"number"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1560,3820],"id":"b8dfb0c0-0cb1-446c-bf55-febfdb4226f8","name":"If2"},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Não entendi sua resposta.\n\nTransferindo para Falar com Atendente.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1780,3720],"id":"cd2c1eb9-b5aa-447c-8249-aada6ea17fff","name":"Evolution API","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Chip5","remoteJid":"={{ $('DadosWhastApp').item.json.remoteJid }}","messageText":"=Não entendi sua resposta.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1780,3900],"id":"cd3542ad-bfb7-4a6d-9edd-199c5ca9fa11","name":"Evolution API1","credentials":{"evolutionApi":{"id":"AM7TR8XRMXSro6aN","name":"Evolution account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7a0f075b-2f79-4199-81b6-46c8587f0a2d","leftValue":false,"rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1480,2880],"id":"3295130a-d228-4137-841f-df4214baf2f2","name":"If3"},{"parameters":{"url":"https://mobilevet-homolog.azurewebsites.net/api/chatwoot/EmAtendimento","sendBody":true,"bodyParameters":{"parameters":[{"name":"celular","value":"={{ $('DadosWhastApp').item.json.remoteJid }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1740,2880],"id":"e79e00fc-ae48-4c27-aec3-f1edde4a41c4","name":"HTTP Valida EmAtendimento"}],"connections":{"MSG Confirmação Erro":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Confirma Agendamento":{"main":[[{"node":"ResultadoConfirmacao","type":"main","index":0}]]},"Confirmado com Sucesso?":{"main":[[{"node":"MSG Confimação Sucesso","type":"main","index":0}],[{"node":"MSG Confirmação Erro","type":"main","index":0}]]},"Cancelado com sucesso?":{"main":[[{"node":"MSG Cancelamento sucesso","type":"main","index":0}],[{"node":"MSG Erro Cancelamento","type":"main","index":0}]]},"MSG Confimação Sucesso":{"main":[[{"node":"Redis","type":"main","index":0}]]},"bloqueia_grupo1":{"main":[[{"node":"DadosWhastApp","type":"main","index":0}]]},"Webhook1":{"main":[[{"node":"bloqueia_grupo1","type":"main","index":0}]]},"Tipo Mensagem1":{"main":[[{"node":"Block IA1","type":"main","index":0}],[{"node":"Confirmação Exame1","type":"main","index":0}]]},"Confirmação Exame1":{"main":[[{"node":"ListaIds","type":"main","index":0}],[{"node":"ListaIds1","type":"main","index":0}],[{"node":"MSG Reagendamento","type":"main","index":0}],[{"node":"MSG Cancelamento Definitivo","type":"main","index":0}],[{"node":"Redis5","type":"main","index":0}],[{"node":"MSG Agendamento","type":"main","index":0}],[{"node":"MSG Atendimento","type":"main","index":0}],[{"node":"MSG Financeiro","type":"main","index":0}],[{"node":"MSG Linklaudo","type":"main","index":0}],[{"node":"HTTP Valida EmAtendimento","type":"main","index":0}]]},"If Nova Mensagem1":{"main":[[{"node":"MSG Saudacao1","type":"main","index":0}],[{"node":"Edit Fields3","type":"main","index":0}]]},"MSG Saudacao1":{"main":[[{"node":"MSG Lista Inicial1","type":"main","index":0}]]},"MSG Lista Inicial1":{"main":[[{"node":"Redis4","type":"main","index":0}]]},"Teste 10 min.1":{"main":[[{"node":"If Nova Mensagem1","type":"main","index":0}]]},"Redis5":{"main":[[{"node":"Teste 10 min.1","type":"main","index":0}]]},"MSG Cancelamento sucesso":{"main":[[{"node":"Redis","type":"main","index":0}]]},"MSG Erro Cancelamento":{"main":[[{"node":"Redis","type":"main","index":0}]]},"MSG Reagendamento":{"main":[[{"node":"Redis","type":"main","index":0}]]},"MSG Cancelamento Definitivo":{"main":[[{"node":"Redis","type":"main","index":0}]]},"MSG Agendamento":{"main":[[{"node":"MSG Tranf Agendamento","type":"main","index":0}]]},"MSG Atendimento":{"main":[[{"node":"MSG Tranf Atendimento","type":"main","index":0}]]},"MSG Financeiro":{"main":[[{"node":"MSG Tranf Financeiro","type":"main","index":0}]]},"Consulta Cliente":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[],[{"node":"MSG Confirgma Cliente","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Consulta Cliente","type":"main","index":0}],[{"node":"Salva IdCliente","type":"main","index":0}],[{"node":"Solicitar Documento","type":"main","index":0}],[{"node":"Solicitar Data Laudo","type":"main","index":0}],[{"node":"Valida Texto Livre","type":"main","index":0}]]},"Solicitar Documento":{"main":[[]]},"Valida Texto Livre":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Consulta Cliente1","type":"main","index":0}],[{"node":"Consulta Cliente1","type":"main","index":0}],[{"node":"Salva IdCliente2","type":"main","index":0}],[{"node":"Redis1","type":"main","index":0}]]},"Consulta Cliente1":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Solicitar Documento1","type":"main","index":0}],[{"node":"Salva IdCliente1","type":"main","index":0}]]},"HTTP Consulta Laudos":{"main":[[]]},"MSG Linklaudo":{"main":[[{"node":"Enviar Link","type":"main","index":0}]]},"Enviar Link":{"main":[[{"node":"Encerrando Atendimento","type":"main","index":0}]]},"Encerrando Atendimento":{"main":[[{"node":"Redis","type":"main","index":0}]]},"HTTP Consulta Laudos1":{"main":[[]]},"Edit Fields3":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Salva IdCliente":{"main":[[{"node":"HTTP Consulta Laudos1","type":"main","index":0}]]},"Salva IdCliente1":{"main":[[{"node":"HTTP Consulta Laudos","type":"main","index":0}]]},"Salva IdCliente2":{"main":[[{"node":"Consulta Laudo Data","type":"main","index":0}]]},"Consulta Laudo Data":{"main":[[]]},"Loop Over Items2":{"main":[[{"node":"Confirmado com Sucesso?","type":"main","index":0}],[{"node":"Confirma Agendamento","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"DadosWhastApp":{"main":[[{"node":"Tipo Mensagem1","type":"main","index":0}]]},"ResultadoConfirmacao":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"ListaIds":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Confirma Agendamento1":{"main":[[{"node":"ResultadoConfirmacao1","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Cancelado com sucesso?","type":"main","index":0}],[{"node":"Confirma Agendamento1","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"ResultadoConfirmacao1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"ListaIds1":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"Redis2","type":"main","index":0}]]},"Redis2":{"main":[[{"node":"If2","type":"main","index":0}]]},"If2":{"main":[[{"node":"Evolution API","type":"main","index":0}],[{"node":"Evolution API1","type":"main","index":0}]]},"If3":{"main":[[{"node":"Redis5","type":"main","index":0}]]},"HTTP Valida EmAtendimento":{"main":[[{"node":"If3","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"7c7b05c7-3f08-4b41-8639-62d2fb57422c","triggerCount":1,"tags":[]}